theme(axis.text.x=element_text(angle=60), legend.position="top")
ggplot(dta3,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
theme(axis.text.x=element_text(angle=60), legend.position="top")
ggplot(dta3,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
scale_x_discrete(breaks=c(0,1,2,3),
labels=c("a", "a",
"a", "a"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
ggplot(dta3,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
#scale_x_discrete(labels=c("0"="消費1次", "1"="消費週期小於1",
#"2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
ggplot(dta3,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
scale_x_discrete(limits=c("0"="消費1次", "1"="消費週期小於1",
"2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
ggplot(dta3,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
scale_x_discrete(labels=c("0"="消費1次", "1"="消費週期小於1",
"2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
ggplot(dta3,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
#scale_x_discrete(labels=c("0"="消費1次", "1"="消費週期小於1",
# "2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount),
n =n())
View(b)
View(filter_g3)
View(filter_g3)
filter_g3 <- count(b[,c(2)],MemberId )
View(filter_g3)
purchasefreq <- count(b[,c(2)],MemberId )
dta4 <- left_join(dta3, purchasefreq ,by= c("MemberId"))
View(dta4)
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
purchasefreq <- count(b[,c(2)],MemberId )
dta4 <- left_join(dta3, purchasefreq ,by= c("MemberId"))
mean(dta3$totalpay)
sd(dta3$totalpay)
ggplot(dta3, aes(x= membertype, y= totalpay))+
geom_point()
view(dta3)
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0"
totalpay > m-s & totalpay <= m+s ~ "T1",
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
m <- roundmean(dta3$totalpay)
s <- sd(dta3$totalpay)
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
m <- mean(dta3$totalpay)
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
View(dta3)
View(spromotion)
View(sorders)
View(smembers)
View(dta3)
dta2 <- orders[,-c(8,19,21,22,23,24,25,26,27,28)]
View(dta2)
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
left_join(., dta2$City, by= MemberId)
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
left_joinjoin(., dta2$City, by= "MemberId")
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
left_join(., dta2$City, by= "MemberId")
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
cbind(., dta2$City)
dta3 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
left_join(., dta2[,c(2,19)], by= "MemberId")
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
left_join(., dta2[,c(2,19)], by= "MemberId")
View(dta4)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
filter( dta2[,c(18)] %in% .$MemberId)
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype,City) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
d <- dta3 %>%
group_by(membertype) %>%
summarise(pay = round(mean(totalpay)),
quan = round(mean(totalquan)),
discount = abs(round(mean(totaldiscount)))) %>%
mutate(membertype = case_when(membertype == "F0" ~ 0,
membertype == "F1" ~ 1,
membertype == "F2" ~ 2,
membertype == "F3" ~ 3))
ggplot(d,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
#scale_x_discrete(labels=c("0"="消費1次", "1"="消費週期小於1",
# "2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype,City, yearmonth) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
F0 <- filter(dta4, membertype == 0)
F0 <- filter(dta4, membertype == "F0")
View(F0)
F1 <- filter(dta4, membertype == "F1")
View(F1)
View(filter_g3)
filter_g3 <- count(b[,c(2)],MemberId ) %>%
subset(n!=1)
View(filter_g3)
F1 <- filter(dta4, membertype == "F1") %>%
left_join(., filter_g3, by = "MemberId")
View(F1)
F2 <- filter(dta4, membertype == "F2") %>%
left_join(., filter_g3, by = "MemberId")
View(F2)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
subset(membeytype != "F0")
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
subset(membeRtype != "F0")
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
subset(membertype != "F0")
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, stat="count",position="stack",width = .9)
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, stat="count",position="stack",width = .5)
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, stat="count",position="stack",width = .5)+
labs(x = "member type", y = "people", size=16)
orders <- read.csv("C:\\Users\\user\\Desktop\\data_science\\91APP\\Orders.csv",
header=T,sep=",",fileEncoding ="UTF-8-BOM") %>%
mutate(OrderGroupCode=str_trim(OrderGroupCode, side = "both"))
orders <- orders %>%
mutate(weekday = as.POSIXct(SalesOrderSlaveDateTime)) %>%
mutate(weekday = weekdays(weekday)) %>%
mutate(hr = strftime(SalesOrderSlaveDateTime,format="%H" )) %>%
mutate(yearmonth= strftime(SalesOrderSlaveDateTime,format="%Y-%m-%d"))
dta1 <- orders[,c(4,5,6,9,12,13,17,18,29,30)]
## plot G1 (relation between totalpayment ,hr , device)
g1 <- dta1 %>%
group_by(hr,TrackSourceTypeDef) %>%
subset(IsMajor != TRUE) %>%
summarise(meanpay = mean(SalesOrderSlaveTotalPayment, na.rm = TRUE),
sumquantity = sum(Quantity, na.rm = TRUE),
sumpay = sum(SalesOrderSlaveTotalPayment, na.rm = TRUE))
ggplot(g1,aes(x=hr, y=sumpay,group = TrackSourceTypeDef))+
geom_line(aes(color=TrackSourceTypeDef))+
geom_point(aes(color=TrackSourceTypeDef))+
scale_color_manual(values=c("steelblue3", "violetred3","mediumpurple3"))+
labs(x = "hour", y = "mean payment (NT)", size=16)+
theme(axis.text.x=element_text(angle=60),legend.position="top")
## plot G2 (relation between totalpayment ,hr , device)
g2 <- dta1 %>%
group_by(weekday,TrackSourceTypeDef) %>%
subset(IsMajor != TRUE) %>%
summarise(meanpay = mean(SalesOrderSlaveTotalPayment, na.rm = TRUE),
sumquantity = sum(Quantity, na.rm = TRUE),
sumpay = sum(SalesOrderSlaveTotalPayment, na.rm = TRUE))
## plot G2 (relation between totalpayment ,hr , device)
g2 <- dta1 %>%
group_by(weekday,TrackSourceTypeDef) %>%
subset(IsMajor != TRUE) %>%
summarise(meanpay = mean(SalesOrderSlaveTotalPayment, na.rm = TRUE),
sumquantity = sum(Quantity, na.rm = TRUE),
sumpay = sum(SalesOrderSlaveTotalPayment, na.rm = TRUE))
ggplot(g2,aes(x=weekday, y=sumpay,group=TrackSourceTypeDef))+
geom_line(aes(color=TrackSourceTypeDef))+
geom_point(aes(color=TrackSourceTypeDef))+
scale_x_discrete(limits=c("星期一","星期二","星期三","星期四","星期五","星期六","星期日"))+
scale_color_manual(values=c("steelblue3", "violetred3","mediumpurple3"))+
labs(x = "hour", y = "mean payment (NT)", size=16)+
theme(axis.text.x=element_text(angle=60),legend.position="top")
dta2 <- orders[,-c(8,19,21,22,23,24,25,26,27,28)]
## 篩選購物次數>1的客戶
b <- dta2[,c(2,3)] %>%
group_by(OrderGroupCode,MemberId) %>%
summarise(n =n())
## 篩選購物次數>1的客戶
b <- dta2[,c(2,3)] %>%
group_by(OrderGroupCode,MemberId) %>%
summarise(n =n())
filter_g3 <- count(b[,c(2)],MemberId ) %>%
subset(n!=1)
##套回原本的data
g3 <- dta2 %>%
group_by(MemberId,OrderGroupCode,yearmonth) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity)) %>%
filter(MemberId %in% filter_g3$MemberId) %>%
mutate(yearmonth = as.POSIXct(yearmonth))
## 計算同一客戶不同次購買的天數差距
g3 <- g3 %>%
group_by(MemberId) %>%
arrange(yearmonth) %>%
mutate(diff = difftime(lead(yearmonth),yearmonth,units = "days"))
## 計算平均間隔平均間隔天數
a <- subset(g3, diff !=0| NA ) %>% mutate(diff= as.numeric(diff))
meanday <- colMeans(a[,6])
a <- a %>%
mutate(membertype = case_when (diff < meanday ~ "F1",
meanday<=diff & diff < 49.8 ~"F2",
diff >= 49.8 ~"F3"))
head(a)
ggplot(a, aes(x=2,fill=membertype))+
#blank_theme +
geom_bar(stat = "count",position="fill")+
coord_polar(theta = "y")
a <- a %>%
mutate(membertype = case_when (diff < meanday ~ "F1",
meanday<=diff & diff < (meanday*2) ~"F2",
diff >= (meanday*2) ~"F3"))
head(a)
ggplot(a, aes(x=2,fill=membertype))+
#blank_theme +
geom_bar(stat = "count",position="fill")+
coord_polar(theta = "y")
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype,City, yearmonth) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
d <- dta3 %>%
group_by(membertype) %>%
summarise(pay = round(mean(totalpay)),
quan = round(mean(totalquan)),
discount = abs(round(mean(totaldiscount)))) %>%
mutate(membertype = case_when(membertype == "F0" ~ 0,
membertype == "F1" ~ 1,
membertype == "F2" ~ 2,
membertype == "F3" ~ 3))
ggplot(d,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
#scale_x_discrete(labels=c("0"="消費1次", "1"="消費週期小於1",
# "2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
m <- mean(dta3$totalpay)
s <- sd(dta3$totalpay)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2")) %>%
subset(membertype != "F0")
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, stat="count",position="stack",width = .5)+
labs(x = "member type", y = "people", size=16)
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, stat="identity",position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
ggplot(dta4, aes(x= membertype, y = value, fill= membertype2))+
geom_bar(alpha=0.7, stat="identity",position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
ggplot(dta4, aes(x= membertype, y = values, fill= membertype2))+
geom_bar(alpha=0.7, stat="identity",position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
View(dta4)
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype,City) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
d <- dta3 %>%
group_by(membertype) %>%
summarise(pay = round(mean(totalpay)),
quan = round(mean(totalquan)),
discount = abs(round(mean(totaldiscount)))) %>%
mutate(membertype = case_when(membertype == "F0" ~ 0,
membertype == "F1" ~ 1,
membertype == "F2" ~ 2,
membertype == "F3" ~ 3))
ggplot(d,aes(x=membertype))+
geom_line(aes(y = quan, colour="Quantity"),size = 1.5)+
geom_line(aes(y = pay/200, colour="Payment"),size = 1.5)+
geom_bar(aes(y = discount/200, fill= "discount" ),
stat = "identity",width = 0.3)+
scale_y_continuous(sec.axis = sec_axis(~.*200, name = "mean payment (NT)"))+
geom_point(aes(y= pay/200, colour="Payment"), size =3)+
geom_point(aes(y= quan, colour="Quantity"), size = 3)+
scale_color_manual(values=c("steelblue3", "mediumpurple3"))+
scale_fill_manual(values=c("palegreen3"))+
labs(x = "member type", y = "mean quantity", size=16)+
#scale_x_discrete(labels=c("0"="消費1次", "1"="消費週期小於1",
# "2"="消費週期大於1小於2", "3"="消費週期大於2"))+
theme(axis.text.x=element_text(angle=60), legend.position="top")
m <- mean(dta3$totalpay)
s <- sd(dta3$totalpay)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
s <- sd(dta3$totalpay)/(72430^(1/2))
/(72430^(1/2))
s <- sd(dta3$totalpay)
ggplot(dta3, aes(x= MemberId, y= totalpay))+
geom_point()
ggplot(dta3, aes(x= MemberId, y= totalpay))+
geom_point() +
expand_limits( y=c(0, 500000))
ggplot(dta3, aes(x= MemberId, y= totalpay))+
geom_point() +
expand_limits( y=c(0, 50000))
subset(dta3, totalpay > 500000)
dta3 <- subset(dta3, totalpay < 500000)
ggplot(dta3, aes(x= MemberId, y= totalpay))+
geom_point() +
expand_limits( y=c(0, 50000))
s <- sd(dta3$totalpay)/(72430^(1/2))
s <- sd(dta3$totalpay)
m <- mean(dta3$totalpay)
rm(F0, F1, F2)
rm(d)
rm(g1,g2,g3)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
m <- mean(dta3$totalpay)
s <- sd(dta3$totalpay)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
library(data.table)
library(tidyverse)
dta4 <- dta3 %>%
mutate(membertype2 = case_when(totalpay <= m-s ~ "T0",
totalpay > m-s & totalpay <= m+s ~ "T1",
totalpay > m+s ~ "T2"))
ggplot(dta4, aes(x= membertype, fill= membertype2))+
geom_bar(alpha=0.7, position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
dta4 <- dta3 %>%
mutate(year = strftime(yearmonth,format="%Y"))
View(dta3)
dta3 <- left_join(dta2, a[,c(1,7)] ,by= c("MemberId")) %>%
mutate(membertype = replace_na(.$membertype, "F0")) %>%
group_by(MemberId,membertype,City,yearmonth) %>%
summarise(totalpay = sum(SalesOrderSlaveTotalPayment),
totalquan = sum(Quantity),
totaldiscount = sum(PromotionDiscount + ECouponDiscount))
dta4 <- dta3 %>%
mutate(year = strftime(yearmonth,format="%Y"))
ggplot(dta4, aes(x= membertype, fill= year))+
geom_bar(alpha=0.7, position="fill",width = .5)+
labs(x = "member type", y = "people", size=16)
View(dta3)
library(data.table)
library(tidyverse)
library(data.table)
library(tidyverse)
orders <- read.csv("C:\\Users\\user\\Desktop\\data_science\\91APP\\Orders.csv",
header=T,sep=",",fileEncoding ="UTF-8-BOM") %>%
mutate(OrderGroupCode=str_trim(OrderGroupCode, side = "both"))
